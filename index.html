  const metricTitle = {
    peso:"Peso (kg)", talla:"Talla (cm)", imc:"IMC",
    grasa:"% Grasa", fc:"Frecuencia cardiaca (lpm)",
    fr:"Frecuencia respiratoria (rpm)",
    pa:"Presión arterial (mmHg)",
    glu:"Glucosa (mg/dL)"
  };

  let datasets;
  if(CURRENT_METRIC==="pa"){
    datasets = [
      { label:"Sistólica", data:data.map(d=>d.pa_sys) },
      { label:"Diastólica", data:data.map(d=>d.pa_dia) }
    ];
  } else {
    datasets = [{ label: metricTitle[CURRENT_METRIC], data: data.map(d=>d[CURRENT_METRIC]) }];
  }

  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: datasets.map(ds=>({
        label: ds.label,
        data: ds.data,
        tension: .3,
        borderWidth: 2,
        pointRadius: 3,
        fill: false
      }))
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top' } },
      scales: { x:{ grid:{ display:false } } }
    }
  });

  document.querySelectorAll(".tab-btn").forEach(b=>{
    b.classList.toggle("active", b.dataset.metric===CURRENT_METRIC);
  });
}

document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    CURRENT_METRIC = btn.dataset.metric;
    renderChart();
  });
});
</script>
</body>
</html>
